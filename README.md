# Operating-Systems-Principle
notes of OS class

# 操作系统原理

## 结构与硬件支持

### 操作系统虚拟机

- 裸机配置操作系统后称为操作系统虚拟机
- 用户界面
- 屏蔽硬件细节
- 扩展硬件功能
- 系统更安全，可靠，安全

### 操作系统的逻辑结构

- OS的设计和实现思路
- 种类

	- 单体式结构

		- 将4个基本功能（进程、存储、文件、设备）合并为内核
		- 一个逻辑模块的函数可以直接访问另一个逻辑模块的数据结构，提高效率。
		- 修改复杂
		- UNIX

	- 模块式结构

		- 支持动态可安装模块
		- 模块设计独立，调用自由
		- 维护更新困难
		- Linux

	- 微内核结构

		- 客户/服务器结构
		- 微内核:提供OS最基本的核心功能和服务
		- 核外服务器：完成OS的绝大部分功能

			- 进程、虚存、设备管理
			- 以进程形式运行在用户态

		- 内核便于剪裁移植
		- 需要在用户态和内核状态需要频繁切换，效率比单核低
		- Windows NT  Minux

	- 层次式结构

		- 把所有功能模块按照调用次序分别排成若干层，确保各层之间只能是单向依赖或单向调用。
		- TCP/IP协议栈

### 操作系统依赖的基本硬件结构

- CPU

	- 操作系统设计考虑两个问题

		- 性能

			- 系统开销对整体性能的影响

		- 安全

			- 独占资源，允许保存信息而不担心被拷贝或修改

	- 保护机制

		- 保证进程互不干扰
		- 在未被授权前，不能使用资源
		- 实现安全策略

	- 解决方法

		- 将程序分为系统程序（可信），应用程序（不可信）

	- CPU态

		- CPU的工作状态，对资源和指令使用权限的描述
		- 分类

			- 核态

				- 所有资源和指令
				- 管理程序/OS内核

			- 用户态

				- 部分资源
				- 用户程序

			- 管态

				- 介于核态和用户态之间

		- 硬件和OS对CPU的观察

			- 硬件按态
			- CPU按进程

		- Intel：Ring 0 - Ring 3

			- Ring 0 ：特权指令、OS内核、驱动程序
			- Ring 1：管态
			- Ring 3：应用程序

		- 态之间转换

			- 用户态->核态

				- 用户请求OS提供服务
				- 发生中断
				- 内部中断
				- 企图执行特权指令

			- 核态->用户态

				- 中断返回：IRET

- 内存

	- 存储程序和数据的部件
	- 分类

		- 与CPU的联系

			- 主存
			- 辅存

		- 材料

			- 半导体
			- 磁
			- 光

		- 读写方式

			- RAM
			- ROM

	- 分级存储系统

		- CPU访问顺序

			- 1.缓存HIT
			- 2.内存MISS
			- 3.辅存 缺页

- 中断

	- CPU对突发的外部事件的反映过程机制
	- CPU收到外部信号（中断信号）后，停止当前工作，转去处理该外部事件，处理完毕后回到原来工作的中断处（断点）继续原来的工作。
	- 目的

		- 实现并发
		- 实现实时处理
		- 故障自动处理

	- 中断源：引起系统中断的事件
	- 中断类型

		- 分类1

			- 强迫中断：程序没有预期

				- I/O，外部中断

			- 自愿中断：程序有预期

				- 执行访管指令

		- 分类2

			- 外中断：由CPU外部事件引起

				- 不可屏蔽中断

					- 紧急，CPU必须响应

				- 可屏蔽中断

					- 不紧急，可以不响应

			- 内中断：由CPU内部事件引起

				- 访管中断
				- 程序中断

	- 断点

		- 程序中断的地方，将要执行的下一指令的地址
		- CS：IP

	- 过程

		- 识别中断源
		- 保护现场
		- 装入中断服务程序
		- 进入中断服务程序
		- 恢复现场
		- 中断返回：IRET

	- 实质

		- 交换指令执行地址
		- 交换CPU的态

- 时钟

## 绪论

### 地位

- 在应用程序与计算机硬件之间，控制各个组件工作起来
- 与计算机各层关系

	- 是系统软件
	- 但它直接作用于硬件上

		- 为其他系统/应用软件提供接口
		- 各种软件通过OS提供的资源使用硬件资源
		- OS允许不同程序共享硬件资源

	- 与应用的关系

		- 通用OS应与应用无关
		- 支持多应用领域软件

### 定义和特性

- 基本功能

	- 提供操作界面
	- 控制程序运行
	- 管理系统资源
	- 配置系统参数
	- 监控系统状态
	- 工具软件集合

- 定义

	- 大型系统程序
	- 负责计算机系统软硬件资源的分配
	- 控制和协调并发活动
	- 提供用户接口，使用户获得良好的工作环境
	- 简言：1.为用户提供友好的接口；2.管理并调度系统资源

- 特性

	- 并发性

		- 同时处理多个任务的能力

	- 共享性

		- 为多个并发任务提供资源共享

	- 不确定性

		- 具有处理随机事件的能力

			- 中断处理
			- 自动化能力

### 功能

- 用户界面

	- 操作系统的生成

		- 满足特定硬件环境的需要，组装和构建操作系统过程
		- 构建OS映像

	- 操作系统的启动

		- 模式

			- 实模式

				- 实地址模式（REAL MODE）
				- 程序按8086寻址方法访问0-FFFFFH(1MB)空间

					- 前640K(0000-9FFFF):基本内存
					- 中间128K(A0000-BFFFF):显卡显存
					- 后256K(C0000-FFFFF):BIOS

						- BIOS

							- C0000-C7FFF:显示卡BIOS
							- C8000-CBFFF:IDE控制器BIOS
							- F0000-FFFFF:系统BIOS

								- CMOS设置
								- 基本I/O设备中断服务
								- POST

				- 寻址方式：20位物理地址
				- CPU单任务运行

			- 保护模式

				- 保护模式(PROTECT MODE)
				- 寻址方式:段(16位)+偏移量(32位),4GB
				- 虚拟地址
				- 应用系统和操作系统运行环境被保护
				- CPU支持多任务

		- 过程

			- 初始化引导

				- 把OS内核装入内存开始工作
				- 过程

					- 加电，JUMP POST
					- 进入BIOS启动程序

						- 读取0面0道第一扇区的内容
						- MBR主启动记录

							- 存放引导程序
							- 存放在主启动扇区
							- 512字节，AA55结尾

					- 运行引导程序

			- 核心初始化
			- 系统初始化

	- 操作系统的用户界面

		- OS提供给用户控制计算机的机制（用户接口）
		- 类型

			- 操作界面

				- GUI
				- 键盘命令

					- 控制台输入的命令
					- 普通命令
					- 批处理程序
					- shell

			- 系统调用

				- 操作系统内核为应用程序提供的一系列服务/函数
				- 特点

					- 涉及核心资源或硬件操作
					- 运行在核态
					- 每个系统调用有唯一编号
					- 会产生自愿中断

				- Linux通过软中断（INT 80H）向内核发出请求

- 进程管理

	- 进程

		- 描述和管理程序的运行过程
		- 程序在某个数据集合上的一次运行活动
		- 特征

			- 动态性
			- 并发性
			- 异步性
			- 独立性

		- 与程序的区别

			- 动态：程序的一次执行过程
			- 在内存暂存
			- 一个程序可能有多个进程

		- 类型

			- 按权限

				- 系统进程
				- 用户进程

			- 按CPU依赖

				- 偏CPU进程
				- 偏I/O进程

		- 状态

			- 运行状态
			- 就绪状态
			- 阻塞状态
			- 状态变迁

				- 就绪-》运行：进程调度
				- 运行-》就绪：时间片到，被抢占
				- 运行-》阻塞：服务请求，等待信号
				- 阻塞-》就绪：服务完成，信号来到
				- 没有阻塞-》运行
				- 没有就绪-》阻塞

		- 进程控制块PCB

			- 描述进程状态、资源和相关进程的关系的数据结构
			- 进程的标志

	- 线程

		- 一个进程可以创建多个线程
		- 线程间通信十分方便
		- 并发
		- 提高窗口程序的交互性

	- 处理机分配
	- CPU管理
	- 处理及管理
	- 具体功能

		- 进程控制

			- 在进程生存全期间，对其全部行为的控制
			- 创建

				- 创建一个具有指定标识ID的进程
				- 过程

					- 创建PCB
					- 赋予ID
					- 分配空间
					- 插入进程的就绪序列

			- 撤销

				- 撤销一个指定的进程
				- 收回进程所占有的资源，撤销PCB
				- 时机

					- 正常结束
					- 异常结束
					- 外界干预

				- 过程

					- 检索PCB
					- 获取状态

						- 若在运行，则终止进程
						- 若有子进程，先撤销子进程

					- 释放资源
					- 移除PCB

			- 阻塞

				- 停止进程的执行，变为阻塞
				- 时机

					- 请求系统服务
					- 启动某种操作
					- 新数据未到达
					- 无新工作

				- 不同原因有不同的阻塞队列
				- 过程

					- 停止运行
					- 将PCB改为阻塞
					- 插入阻塞队列
					- 转调度程序

			- 唤醒

				- 唤醒处于阻塞队列当中的某个进程
				- 时机

					- 系统服务完成
					- I/O完成
					- 新数据到达
					- 进程提出新请求

			- 原语

				- 由若干指令构成的具有特定功能的函数
				- 具有原子性
				- 进程控制原语

					- 创建
					- 撤销
					- 阻塞
					- 唤醒

			- Windows

				- system
				- CreateProcess
				- ExitProcess

			- Linux

				- fork

					- 返回值pid

						- 0：子进程
						- >0：父进程
						- -1：出错

					- 子进程在fork函数后运行

				- wait(status)

					- 阻塞自己
					- 阻塞到有子进程结束
					- status保存子进程退出时的状态

				- exit(status)

					- 利用status向父进程报告结束时的状态
					- 变为僵尸状态，保留部分PCB信息供wait收集

				- sleep(second)

					- 进程暂停second秒

			- 进程相互制约关系

				- 同步关系

					- 合作进程中某些操作之间需要满足某种先后关系或某个操作能否进行需要某个前提条件满足，否则只能等待
					- 互斥关系

						- 特殊的同步关系
						- 多个进程由于共享具有独占性的资源，必须协调各进程对资源的存取顺序：确保没有任何两个或以上的进程同时进行资源的存取操作。
						- 临界资源

							- 一次只允许一个进程独占访问的资源

						- 临界区

							- 进程中访问临界资源的程序段
							- 并发进程不能同时进入临界区

					- 锁机制

						- 设置一个标志表明临界资源是否可用
						- 进入临界区前检查标志是否可用
						- 进入临界区前执行上锁操作
						- 离开临界区后执行开锁操作

					- 信号灯进程同步机制

						- 设计临界区访问机制的原则

							- 忙则等待
							- 空闲让进
							- 有限等待
							- 让权等待

						- 数据结构

							- S:信号量
							- q:队列

						- 操作

							- P操作

								- S-1
								- 若S>=0 ，继续
								- 若S<0，阻塞，加入q中，转调度函数 

							- V操作

								- S + 1
								- 若S > 0 继续
								- 若S <= 0 继续并唤醒一个进程

						- 应用

							- 实现进程互斥

								- 实质：实现对临界区的互斥访问
								- 进入前执行P
								- 离开后执行V
								- S初值设定要合理，即临界资源的数量

							- 实现进程同步

								- 实质

									- 运行条件不满足时，进程暂停
									- 满足时，进程继续

								- 在关键操作前P
								- 在关键操作后V
								- 定义有意义的信号量S，能明确地表示运行条件

							- 司机VS售票员
							- 共享缓冲区
							- 生产者和消费者
							- 读者和编者
							- 哲学家问题

					- 死锁

						- 定义

							- 两个或多个进程无限期地等待永远不会发生的条件的一种系统状态
							- 在两个或多个进程中，每个进程都持有某种资源，但又继续申请其它进程已持有的某种资源。此时每个进程都拥有其运行所需的一部分资源，但是又都不够，从而每个进程都不能向前推进，陷于阻塞状态。

						- 起因

							- 系统资源有限
							- 并发进程的推进顺序不当

						- 必要条件

							- 多个进程构成环路

								- 环中每个进程已占用的资源被前一进程申请，而自己所需新资源又被环中后一进程所占用
								- 有序资源分配法

									- 破坏环路条件
									- 每个资源分配唯一序号
									- 申请资源只能申请序号更大的资源

							- 互斥
							- 不剥夺
							- 部分分配

								- 预先静态分配法

									- 进程运行前将所需全部资源一次性分配给他
									- 资源利用率低

						- 解决策略

							- 预防

								- 设置某些限制条件，破坏死锁出现的必要条件
								- 较易实现
								- 限制严格，资源利用率低

							- 避免

								- 在资源动态分配过程中，用某种方法分析系统是否将会进入死锁状态

							- 检测
							- 恢复

								- 撤销或挂起一些进程

		- 进程调度

			- 概念

				- 在合适的时候以一定策略选择一个就绪进程运行

			- 目标

				- 响应速度尽可能快
				- 进程处理时间尽可能短
				- 系统吞吐量尽可能大
				- 资源利用率尽可能高
				- 对所有进程公平
				- 避免饥饿
				- 避免死锁

			- 两个量化的衡量指标

				- 周转时间/平均周转时间

					- 周转时间：进程提交给计算机到完成所花费的时间

				- 带权周转时间/平均带权周转时间

					- w = 周转时间/进程运行时间
					- 进程在系统中的相对停留时间

			- 调度算法

				- 先来先服务

					- 只考虑等候时间，没考虑运行时间长短

				- 短作业优先

					- 忽视等待时间，容易出现饥饿现象

				- 响应比高着优先调度

					- 响应比

						- 响应时间/运行时间
						- 1 + 等待时间/运行时间

				- 优先数调度

					- 根据进程优先数，将CPU分配给最高的进程
					- 进程优先数=静态优先数+动态优先数
					- linux：-20(最高)~9(最低)

						- 默认为0
						- 普通用户只能降低优先级

				- 循环轮转调度

					- 将所有就绪进程按先进先出原则排成队列。新来进程加到末尾
					- 刚刚运行了的进程排到末尾
					- 环形
					- 公平性、交互性
					- 时间片大小要适中

				- 可变时间片轮转

					- 时间片大小可变的循环轮转调度

				- 多重时间片循环

					- 组织多个就绪队列的循环轮转调度

			- Linux进程调度

				- 基于优先数调度，选择优先级最高的进程运行
				- 优先级

					- 静态优先级

						- 创建时指定或用户修改

					- 动态优先级

						- 按调度策略改变
						- 非实时进程采用动态优先级
						- counter表示

							- 进程能连续运行的时间，单位是时钟
							- 较高优先级的进程一般counter值较大
							- 子进程新建时，从父进程继承一半

				- 进程类型

					- 普通进程

						- 采用动态优先级调度

					- 实时进程

						- 采用静态优先级调度
						- 由用户指定
						- 先进先出
						- 时间片轮转

					- 实时进程优先级总比普通进程高

				- 调度函数schedule

					- 实现进程调度，在运行队列中找到一个进程分配CPU
					- 方法

						- 直接调度

							- 当前进程阻塞时，直接调用

						- 间接调度

					- 主要工作

						- 选择进程

							- 若优先级相同，选择counter值大的
							- 若都相等，选择队列前面的

						- 切换进程

							- 将当前进程放在等待队列
							- 让新进程运行

		- 进程通信

- 存储管理

	- 为应用程序运行提供内存空间
	- 支持多道程序设计
	- 具体功能

		- 地址映射

			- 把程序中的地址变换为真实的内存地址的过程
			- 方式

				- 固定地址映射

					- 编程编译时确定映射关系
					- 特点

						- 加载时必须放在指定的内存区域
						- 容易产生地址冲突
						- 不能适应多道环境

				- 静态地址映射

					- 程序装入时由操作系统完成映射，保证运行前所有地址绑定到主存
					- 相关概念

						- 逻辑地址：VA
						- 装入基址：BA
						- 物理地址：MA

					- MA = BA + VA
					- 特点

						- 运行前确定映射关系
						- 装入后不能移动，移动必须放回原来位置
						- 占用连续内存空间

				- 动态地址映射

					- 在执行过程中临时映射
					- MA = BA + VA
					- 通过重定位寄存器进行重定位
					- 特点

						- 占用内存空间可动态变化
						- 不要求占用连续内存空间
						- 便于多个进程共享代码
						- 需要硬件支持（MMU）或软件但复杂

		- 虚拟存储(存储扩充)

			- 解决问题

				- 程序过大过多时，内存不够
				- 多个程序并发时地址冲突

			- 借助辅存在逻辑上扩充内存
			- 过程

				- 迁入

					- 将要运行的部分装入内存

				- 迁出

					- 把当前不运行的部分暂存在辅存

			- 前提

				- 程序局部性原理

					- 时间局部性

						- 在较短时间重复访问

					- 空间局部性

						- 临近单元短时间内集中访问

					- 程序在一个有限的时间段内访问的代码和数据往往集中在有限的地址范围内。因此，一般情况下，把程序的一部分装入内存在较大概率上足够让其运行。

				- 足够的辅存
				- 适量的内存
				- 地址变换机构

			- 应用

				- 页式虚拟存储
				- 段式虚拟存储

		- 内存分配

			- 为程序运行分配足够的内存空间
			- 解决问题

				- 分配策略
				- 放置策略
				- 调入策略
				- 淘汰策略

		- 内存保护

			- 在内存中的多道程序只能在给定的存储区域内活动互不干扰

				- 防止访问越界越权

			- 方法

				- 界址寄存器

					- 设置上下限寄存器
					- 基址寄存器和限长寄存器
					- 适用于连续物理分区

				- 存储键保护

					- 适用于不连续物理分块

		- 内存共享
		- 物理内存管理

			- 单一区存储管理

				- 用户区不分区，完全被一个程序占用

					- e.g.:DOS

				- 简单
				- 内存浪费，利用率低

			- 分区存储管理

				- 把用户区内存划分为若干大小不等的分区，供不同的程序使用
				- 适用于单用户单任务系统
				- 分类

					- 固定分区

						- 把内存固定地划分为若干大小不等分区供各个程序使用
						- 每个分区大小位置固定
						- 分区表

							- 记录分区位置、大小、使用标志

						- 特点

							- 装入前内存已分区不再改变
							- 每个分区大小不同以适应不同大小的程序
							- 维护分区表
							- 浪费内存
							- 大程序无法运行

					- 动态分区

						- 在程序装入时创建分区，使分区大小刚好与程序大小相等
						- 特点

							- 分区个数大小可变
							- 会产生内存碎片：过小的空闲区，难实际利用

						- 分区分配

							- 在所有空闲区中寻找一个空闲区分配给用户使用
							- 空闲区表

								- 描述内存空闲区的位置和大小的数据结构

							- 过程

								- 从表中第一区开始，寻找>= SIZE的空闲区
								- 分割出SIZE给用户使用(从底部分割)
								- 将剩余部分登记在表中

						- 分区选择

							- 选择表中第一个满足要求的分区
							- 空闲区表排序原则

								- 按空闲区位置递增排序

									- 首次适应法

										- 尽可能利用低地址空间，保证高地址空间有较大的空闲区

								- 按空闲区位置递减排序
								- 按空闲区大小递增

									- 最佳适应法

										- 尽量保留较大空闲区

								- 按空闲区大小递减

									- 最坏适应法

										- 被分割后剩余部分还很大，还能装大程序
										- 仅作一次查找就能找到所要分区

						- 分区回收

							- 回收程序结束后释放分区，适当处理后登记到空闲区表中
							- 回收算法

								- 释放区与空闲区是否相邻

									- 是：合并后插入
									- 否：直接插入

							- 过程

								- 四种情况

									- 更新大小
									- 更新位置和大小
									- 先删除后更新大小
									- 插入

							- 碎片问题

								- 内存拼接技术

									- 将所有空闲区集中一起构成大空闲区
									- 时机

										- 释放区回收时
										- 系统找不到足够大的空闲区时
										- 定期

									- 消耗系统资源

								- 规定门限值
								- 将程序拆成几部分装入不同分区

			- 内存覆盖技术

				- 在较小内存空间运行较大程序
				- 将内存分区

					- 常驻区

						- 被单独固定占用的区域

					- 覆盖区

						- 被多段共用的区域

				- 原理

					- 程序分成若干代码段或数据段，将程序常用的段装入常驻区；（核心段） 正运行的段处于覆盖区； 目前不运行的段放在硬盘中(覆盖文件)；
 要用的段从硬盘装入覆盖区（覆盖旧内容）

				- 减少程序对内存需求
				- 编程复杂，程序执行时间长

			- 内存交换技术

				- 内存不够时把进程写道磁盘(换出)
				- 进程要运行时重新写回内存(换入)
				- 增加进程并发数
				- 增加了CPU开销；对换单位太大

		- 虚拟内存管理

			- 虚拟内存

				- 面向用户的虚拟封闭存储空间
				- 线性地址空间
				- 容量32位，4G
				- 和物理地址分离

			- 目标

				- 大程序能在小内存运行
				- 多程序能在小内存运行
				- 多程序并发不冲突
				- 利用效率高，无碎片，共享方便

			- 方式

				- 页式存储管理

					- 把进程空间和内存空间都划分为等大小的小片
					- 进程：页
					- 内存：页框/块
					- 原则

						- 内存以页框为单位分配
						- 进程以页为单位装入内存

							- 装入部分页
							- 页占用的页框不必相邻
							- 需要新页时从硬盘调入内存
							- 不运行的页及时删除

					- 页式系统中的地址

						- 从0开始
						- VA分为页号P和页内偏移W
						- P = VA/页大小
						- W = VA % 页大小

					- 地址映射

						- 页表

							- 记录页与页框之间的对应关系
							- 页表地址寄存器

								- 页表在内存的存放地址

							- 在内存中：慢表
							- 在Cache中：快表

								- 地址映射优先访问快表

									- 若找到，即命中
									- 未找到，则访问慢表，并更新快表

						- 过程

							- 从VA分离P和W
							- 以P查页表得到页框号P‘
							- MA = P' * 页大小 + W

					- 防止越界访问界面

						- 检查访问的目的页号X是否在进程内
						- 0<=X<虚拟页数
						- 若越界，产生缺页中断

					- 页面共享

						- 不同进程的页表中填上相同的页框号
						- 节省内存

					- 建立

						- 操作系统为每个进程建立一个页表
						- 长度和首址存放在进程控制块PCB中

							- 长度：页表长度寄存器
							- 首址：页表首址寄存器

					- 扩充

						- 中断位I

							- I = 1：不在内存
							- I = 0：在内存

						- 辅存地址

							- 该页在辅存上的位置

						- 修改位

							- 0：未被修改
							- 1：已被修改

						- 访问位

							- 0：最近没有被访问
							- 1：最近已被访问

					- 缺页中断

						- 与普通中断的不同

							- 响应时机

								- 普通：在指令完成后响应
								- 缺页：在指令执行过程中发生

							- 频率

								- 一条指令执行是可能发生多次缺页中断

						- 淘汰策略

							- 选择淘汰哪一页的规则
							- 页面抖动

								- 页面在内存和辅存间频繁交换的现象
								- 会使效率下降

							- 常见淘汰算法

								- 最佳算法OPT

									- 淘汰以后不再需要或最远的将来才会用到的页面
									- 理论上最佳，实践中无法实现

								- 先进先出淘汰算法FIFO

									- 淘汰在内存中停留时间最长的页面
									- 实现简单
									- 只要顺序访问时命中率才最理想

								- 最久未使用淘汰算法LRU

									- 淘汰最长时间未被使用的页面
									- 页面设置一个定时器
									- 页面被访问则重置1

								- 最不经常使用LFU

									- 淘汰当前被访问次数最少的页面
									- 发生缺页中断时，先淘汰，并将所有计数清零

						- 影响缺页的因素

							- 淘汰算法
							- 分配给进程的页框数

								- 页框越少，越容易缺页

							- 页本身大小

								- 页面越小，越容易缺页

							- 程序编制方法

								- 局部性越好，越不容易缺页
								- 跳转或分支越多越容易分页

					- 不足

						- 页面划分无逻辑含义
						- 页共享不灵活
						- 页内碎片

				- 段式存储管理

					- 进程分段

						- 把进程按逻辑意义划分为多个段，每个段有段名，长度不定

							- e.g. 代码段、数据段、堆栈段

					- 以段为单位装入，每段分配连续的内存。但段与段不要求相邻
					- 虚拟地址VA：段号S和段内偏移W
					- 段式地址映射

						- 段表

							- 记录每段在内存中的位置
							- 段号S：段的唯一编号
							- 段长L：该段的长度
							- 基地址B：该段在内存中的首地址

						- 映射过程

							- 1.由VA分离出S，W
							- 2.查询段表

								- 以S为索引查询B和L

							- 3.MA = B + W

					- 段共享

						- 原理同页面共享

					- 缺点

						- 段需要连续的存储空间
						- 段最大尺寸受到内存大小限制
						- 在辅存中管理可变尺寸的段比较困难

					- 与页的区别

						- 段长可变
						- 段划分有意义
						- 段方便共享
						- 段用户可见
						- 段偏移有溢出

				- 段页式存储管理

					- 在段中划分页面
					- 地址构成

						- 段号S，页号P，页内偏移
						- 内存按页划分，按页装入

					- 地址映射

						- 同时采用段表和页表

							- 每个进程建立一个段表

								- 给出每段的页表基地址和页表长度

							- 每个段建立一个页表

								- 给出每页对应的页框

- 设备管理

	- 提供统一的设备资源使用接口，管理设备的分配和使用

		- 设备无关性
		- 设备的传输控制
		- 设备的驱动

	- 设备类型和特征

		- 分类

			- 交互对象

				- 人机交互设备

					- 显示设备
					- 键盘
					- 鼠标
					- 打印机

				- 与CPU交互

					- 磁盘
					- 磁带
					- 传感器
					- 控制器

				- 计算机间的通信设备

					- 网卡
					- 调制解调器

			- 交互方向

				- 输入：键盘，扫描仪
				- 输出：显示设备，打印机
				- 双向：硬盘，网卡

			- 外设特性

				- 使用特征

					- 存储、输入输出

				- 数据传输率

					- 低速、中速、高速

				- 信息组织特征

					- 字符设备：打印机
					- 块设备：磁盘
					- 网络设备

	- 具体功能

		- 状态跟踪

			- 动态记录各设备的状态

		- 设备分配

			- 设备管理的基本任务
			- 按照一定策略，为申请设备的进程分配设备，记录设备使用情况
			- 方法

				- 独享分配

					- 独占性设备

						- 任意时间段内只能被一个进程占用
						- 使用前，进程需要先向系统申请，用完后要释放

				- 共享分配

					- 共享性设备

						- I/O传输单位：块
						- 宏观上可被多个进程同时占用
						- 微观上依旧是交替使用同一设备

				- 虚拟分配

					- 虚拟设备

						- 用来模拟独占设备的部分辅存
						- 输入井：模拟输入设备的辅存区域
						- 输出井：模拟输出设备的辅存区域

					- 虚拟技术

						- 借助辅存的一部分区域模拟独占设备，将其转化为共享设备

					- SPOOLING

						- 构成

							- 软件

								- 输入程序
								- 缓输出程序
								- 井管理程序
								- 预输入表
								- 缓输出表

							- 硬件

								- 输入井和输出井
								- 输入缓冲区和输出缓冲区

						- 工作机制

							- 用户将输出数据先传送到输出井。当输出设备空闲时，再送到输出设备上
							- 预输入进程和缓输出进程模拟卫星机

						- 提高了I/O速度
						- 将独占设备改造为共享设备，实现了虚拟设备功能

		- 设备映射

			- 设备分类

				- 物理设备

					- IO系统中实际安装的设备
					- 物理名：ID或字符串

				- 逻辑设备

					- 应用软件使用的设备

						- 从应用软件角度看，逻辑设备时一类物理设备的抽象
						- 从设备管理程序角度看，物理设备是逻辑设备的实例

					- 逻辑名：友好名

			- 功能

				- 设备管理模块将逻辑设备映射到物理设备的功能

		- 设备控制

			- 设备驱动

				- 对物理设备进行控制，实现I/O操作
				- 接受应用发来的服务请求，例如读写命令，把它转换成一系列具体的I/O指令，控制设备完成相关操作
				- 向用户提供相关的设备使用接口
				- 设备驱动程序特点

					- 与硬件密切相关
					- 每类设备都要配置特定的驱动程序
					- 由设备厂商根据操作系统要求编写
					- 操作系统仅对与设备驱动的接口提出要求

		- I/O缓冲区管理

			- 功能

				- 组织I/O缓冲区
				- 为使用者提供获得和释放I/O缓冲区的手段

- 文件管理

	- 文件和目录的管理

		- 文件

			- 概念

				- 系统中信息存放的一种组织形式
				- 若干信息项的构成
				- 用户通过读写指针存取文件的信息项
				- 文件由文件名，用户通过文件名存取文件

			- 分类

				- 用途

					- 用户文件
					- 库文件

						- 用户只能使用，不能修改

					- 系统文件

				- 操作权限

					- 只读文件
					- 读写文件
					- 不保护文件

				- 文件性质

					- 普通文件
					- 目录文件
					- 设备文件

			- 属性

				- 文件类型、操作特性和存取保护等一组信息
				- 存放在文件的目录项中

			- 文件系统

				- 操作系统中负责管理文件的机构
				- 负责文件的创立、撤销、读写、修改、复制和存取控制，管理存放文件的各种资源

			- 文件的逻辑结构

				- 为用户提供逻辑结构清晰、使用方便的文件
				- 强调文件信息项的构成方式和用户的存取方式
				- 分类

					- 流式文件

						- 信息项是字节
						- 无需额外说明信息，由应用程序解释和处理

					- 记录式文件

						- 信息项由记录组成

			- 文件的物理结构

				- 文件再存储设备上的存储方式
				- 强调合理利用储存空间，缩短I/O存取时间
				- 类型

					- 连续文件
					- 索引文件（类似页表）
					- 串联文件（类似链表）

						- FAT文件系统

			- 存取方法

				- 顺序存取
				- 随机存取

		- 存储空间管理

			- 记录当前磁盘的使用情况，创建文件时分配空间，删除时收回空间
			- 记录磁盘空闲块的方法

				- 空闲文件目录
				- 空闲块链
				- 位示图

		- 文件操作
		- 目录管理

			- 文件目录

				- 记录文件名和存放地址的目录表
				- 将文件名转换为外存物理位置

			- 目录文件

				- 以文件形式存于外存

		- 存取权限管理

	- 提供简便统一的信息存取和管理方法，并解决信息共享、数据的存取控制等问题

### 性能

- 评价指标

	- 吞吐率
	- 响应能力
	- 资源利用率
	- 可移植性
	- 可靠性

### 发展历史

- 手工操作

	- 没有操作系统
	- 使用卡片/纸带
	- CPU有效运行事件极低

- 单道批处理程序

	- 装入-运行-撤出
	- 外设工作时CPU空闲，CPU工作时外设空闲
	- 效率低
	- 特点：一批、自动、单道（串行）
	- 实现方式

		- 联机批处理

			- 主机控制输入输出
			- 系统效率低

		- 脱机批处理

			- 卫星机控制输入/输出
			- 效率较高
			- 调度不灵活；保护问题

- 多道批处理系统

	- 多道程序设计技术

		- 在内存中存放多道程序
		- 当某道程序因为某种原因（例如请求I/O时）不能继续运行时，监控程序便调度另一程序投入运行。
		- 使CPU尽量处于忙碌状态，提高效率
		- 目的：提高系统利用率（CPU、外设间并行）
		- 意义：它的出现代表操作系统的形成
		- 缺点

			- 作业处理事件长
			- 交互能力差
			- 运行过程不确定

	- 特点

		- 多道

			- 内存存放多道程序

		- 宏观上并行
		- 微观上串行

- 分时操作系统

	- 要求

		- 交互性高
		- 响应快速
		- 多任务多用户

	- 分时技术

		- 主机以很短的时间片为单位，把CPU循环地分配给每个作业使用
		- 特点

			- 时间片：较短时间间隔
			- 每个作业能及时得到系统相应：独占主机

	- 特点

		- 多路调制性

			- 多用户联机使用同一台计算机

		- 独占性

			- 用户感觉独占计算机

		- 交互性

			- 及时响应用户请求

	- 实践

		- UNIX

			- 第一个实用化的分时操作系统

	- 衍化

		- 实时操作系统

			- 某些任务要优先紧急处理
			- 强调作业完成的时限
			- 强调可靠性
			- 安全性
			- 与嵌入式系统相关
			- 分类

				- 硬实时系统：必须限时完成

					- 制导系统

				- 软实时系统：尽可能快完成

					- 网络视频

		- 微机操作系统（PC机）

			- 个人计算机
			- MSDOS
			- Windows

		- 多处理机操作系统

			- 并行系统
			- 紧耦合，可扩展性差
			- 不支持大规模并行计算，不支持分布处理

		- 网络操作系统

			- 计算机的集合
			- 操作系统+网络通信+网络服务
			- 具有消息通信机制
			- 不能统一管理；不能合作计算

		- 分布式操作系统
		- 嵌入式操作系统

			- 约等于实时操作系统
			- 软硬件可以裁剪
			- Linux,IOS,Andriod

*XMind - Trial Version*
